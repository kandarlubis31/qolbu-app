---
import BaseLayout from '../layouts/BaseLayout.astro';

// Daftar Surat Spesial (Halaman Lokal yang lu buat)
const specialSurahs = [
  { number: 36, name: "Yasin", arti: "Yasin", href: "/yasin", color: "bg-emerald-100 text-emerald-600 dark:bg-emerald-900/30 dark:text-emerald-400" },
  { number: 18, name: "Al-Kahfi", arti: "Gua", href: "/kahfi", color: "bg-amber-100 text-amber-600 dark:bg-amber-900/30 dark:text-amber-400" },
  { number: 56, name: "Al-Waqiah", arti: "Hari Kiamat", href: "/waqiah", color: "bg-purple-100 text-purple-600 dark:bg-purple-900/30 dark:text-purple-400" },
  { number: 67, name: "Al-Mulk", arti: "Kerajaan", href: "/mulk", color: "bg-indigo-100 text-indigo-600 dark:bg-indigo-900/30 dark:text-indigo-400" },
];
---

<BaseLayout pageTitle="Al-Qur'an">
  
  <div class="sticky top-16 z-30 bg-white/90 dark:bg-slate-900/90 backdrop-blur-md px-4 py-3 flex items-center justify-between border-b border-slate-100 dark:border-slate-800 shadow-sm">
    <a href="/" class="flex items-center gap-2 text-slate-500 hover:text-emerald-600 transition-colors p-2 -ml-2 rounded-lg active:bg-slate-50 dark:active:bg-slate-800">
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"/></svg>
      <span class="font-medium text-sm">Dashboard</span>
    </a>
    <h1 class="font-bold text-slate-800 dark:text-white">Al-Qur'an</h1>
    <div class="w-8"></div> </div>

  <div class="pb-20 pt-6 px-4 w-full max-w-md mx-auto">
    
    <div class="relative mb-8">
      <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-slate-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" /></svg>
      </div>
      <input type="text" id="search-surah" placeholder="Cari surat..." class="w-full pl-10 pr-4 py-3 rounded-xl bg-slate-100 dark:bg-slate-800 border-none text-slate-800 dark:text-white placeholder-slate-400 focus:ring-2 focus:ring-emerald-500 outline-none transition-all" />
    </div>

    <div class="mb-8">
      <h2 class="text-sm font-bold text-slate-500 uppercase tracking-wider mb-4 px-1">Surat Pilihan</h2>
      <div class="grid grid-cols-2 gap-3">
        {specialSurahs.map((item) => (
          <a href={item.href} class="flex flex-col p-4 rounded-2xl bg-white dark:bg-slate-800 border border-slate-100 dark:border-slate-700 shadow-sm hover:shadow-md transition-all active:scale-95">
            <div class="flex justify-between items-start mb-2">
              <div class={`w-8 h-8 rounded-lg flex items-center justify-center text-xs font-bold ${item.color}`}>
                {item.number}
              </div>
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" class="text-slate-300" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m9 18 6-6-6-6"/></svg>
            </div>
            <h3 class="font-bold text-slate-800 dark:text-white">{item.name}</h3>
            <p class="text-xs text-slate-500 dark:text-slate-400">{item.arti}</p>
          </a>
        ))}
      </div>
    </div>

    <div>
      <h2 class="text-sm font-bold text-slate-500 uppercase tracking-wider mb-4 px-1">Daftar Surat (114)</h2>
      <div id="surah-list" class="space-y-3">
        {[1,2,3,4,5].map(() => (
          <div class="animate-pulse flex items-center justify-between p-4 bg-white dark:bg-slate-800 rounded-2xl border border-slate-100 dark:border-slate-700">
            <div class="flex gap-3 items-center">
              <div class="w-8 h-8 bg-slate-200 dark:bg-slate-700 rounded-lg"></div>
              <div class="h-4 w-24 bg-slate-200 dark:bg-slate-700 rounded"></div>
            </div>
          </div>
        ))}
      </div>
    </div>

  </div>

</BaseLayout>

<script is:inline>
  document.addEventListener('DOMContentLoaded', async () => {
    const listContainer = document.getElementById('surah-list');
    const searchInput = document.getElementById('search-surah');
    let allSurahs = [];

    // Fetch Data dari API Publik (EQuran.id)
    try {
      const res = await fetch('https://equran.id/api/v2/surat');
      const json = await res.json();
      
      if(json.code === 200) {
        allSurahs = json.data;
        renderSurahs(allSurahs);
      } else {
        listContainer.innerHTML = '<p class="text-center text-red-500">Gagal memuat data.</p>';
      }
    } catch (e) {
      console.error(e);
      listContainer.innerHTML = '<p class="text-center text-slate-500">Mode Offline.</p>';
    }

    function renderSurahs(data) {
      let html = '';
      data.forEach(surah => {
        // Cek apakah surat ini ada di "Special List" (Yasin, dll)
        // Kalau ada, link-nya ke file lokal kita (/yasin), kalau gak ada link ke detail API (nanti bisa dikembangin)
        let link = '#'; 
        const specials = { 36: '/yasin', 18: '/kahfi', 56: '/waqiah', 67: '/mulk' };
        
        if (specials[surah.nomor]) {
          link = specials[surah.nomor];
        } else {
          // Sementara '#' atau bisa buat halaman dynamic /quran/[nomor] nanti
          link = '#'; 
        }

        html += `
          <a href="${link}" class="surah-item group flex items-center justify-between p-4 bg-white dark:bg-slate-800 rounded-2xl border border-slate-100 dark:border-slate-700 hover:border-emerald-500 transition-all ${link === '#' ? 'opacity-80 cursor-default' : 'active:scale-95 cursor-pointer'}">
            <div class="flex items-center gap-4">
              <div class="w-9 h-9 rounded-xl bg-slate-50 dark:bg-slate-700 flex items-center justify-center text-sm font-bold text-emerald-600 dark:text-emerald-400 group-hover:bg-emerald-500 group-hover:text-white transition-colors">
                ${surah.nomor}
              </div>
              <div>
                <h3 class="font-bold text-slate-800 dark:text-white">${surah.namaLatin}</h3>
                <p class="text-xs text-slate-500 dark:text-slate-400">${surah.arti} â€¢ ${surah.jumlahAyat} Ayat</p>
              </div>
            </div>
            <p class="font-amiri text-lg text-slate-400 dark:text-slate-500 group-hover:text-emerald-600 transition-colors">${surah.nama}</p>
          </a>
        `;
      });
      listContainer.innerHTML = html;
    }

    // Search Logic
    searchInput.addEventListener('input', (e) => {
      const term = e.target.value.toLowerCase();
      const filtered = allSurahs.filter(s => 
        s.namaLatin.toLowerCase().includes(term) || 
        s.arti.toLowerCase().includes(term)
      );
      renderSurahs(filtered);
    });
  });
</script>